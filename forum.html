<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forum</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="forum.css">
    <style>
      .black-glass {
          background: rgba(5, 6, 10, 0.72);
          border: 1px solid rgba(255, 255, 255, 0.22);
          box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6);
          backdrop-filter: blur(18px) saturate(110%);
          -webkit-backdrop-filter: blur(18px) saturate(110%);
          color: #fff;
          border-radius: 16px;
      }
      .forum-shell { max-width: 1100px; margin: 0 auto; padding: 0 1rem; min-height: 100vh; display: flex; flex-direction: column; transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
      .forum-shell.popup-open { margin-left: 320px; }
      .forum-header.black-glass { border-radius: 18px; }
      .forum-header h1 { color: #fff; }
      .forum-header p { color: rgba(255,255,255,0.85); }
      .class-strip { display:flex; align-items:center; justify-content:center; gap:.8rem; margin: 1rem 0 0 0; }
      .class-chip { background: rgba(255,255,255,0.14); color: #fff; border: 1px solid rgba(255,255,255,0.25); padding: .3rem .7rem; border-radius: 999px; font-weight: 600; }
      .status-chip { background: rgba(0, 200, 140, 0.2); color:#aef9e4; border:1px solid rgba(0,200,140,0.35); padding: .25rem .6rem; border-radius:999px; font-weight:600; }
      .status-chip.unpaid { background: rgba(255, 255, 255, 0.12); color:#ffd2d2; border-color: rgba(255,255,255,0.25); }
      /* Enhanced Message Container - ChatGPT Style */
      .messages-container.black-glass { 
        padding: 1.5rem; 
        border-radius: 20px; 
        flex: 1; 
        overflow-y: auto; 
        min-height: 60vh;
        max-height: 70vh;
        background: rgba(5, 6, 10, 0.85);
        border: 1px solid rgba(255, 255, 255, 0.15);
        box-shadow: 
          0 20px 60px rgba(0, 0, 0, 0.8),
          0 8px 32px rgba(106, 130, 251, 0.1),
          inset 0 1px 0 rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(24px) saturate(120%);
        -webkit-backdrop-filter: blur(24px) saturate(120%);
      }
      
      .message-content { 
        background: rgba(5,6,10,0.8); 
        color:#fff; 
        border: 1px solid rgba(255,255,255,0.15); 
        box-shadow: 0 12px 32px rgba(0,0,0,0.6);
        border-radius: 16px;
        margin-bottom: 1rem;
        padding: 1rem;
        transition: all 0.3s ease;
      }
      
      .message-content:hover {
        transform: translateY(-2px);
        box-shadow: 0 16px 40px rgba(0,0,0,0.7);
      }
      
      .message-content.own-message { 
        background: rgba(106, 130, 251, 0.15); 
        color:#fff;
        border-color: rgba(106, 130, 251, 0.3);
      }
      
      .message-text { 
        color:#fff; 
        font-size: 1rem;
        line-height: 1.6;
        margin: 0.5rem 0;
      }
      
      .message-avatar { 
        background: rgba(255,255,255,0.14); 
        color:#fff; 
        border: 1px solid rgba(255,255,255,0.25);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-right: 1rem;
      }
      
      .message-header { 
        border-bottom-color: rgba(255,255,255,0.15); 
        padding-bottom: 0.5rem;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
      }
      
      .message-info span { 
        color: rgba(255,255,255,0.8); 
        font-size: 0.9rem;
        margin-right: 1rem;
      }
      
      .message-actions button { 
        background: rgba(255,255,255,0.12); 
        color:#fff; 
        border:1px solid rgba(255,255,255,0.2);
        border-radius: 8px;
        padding: 0.5rem 0.75rem;
        margin: 0.25rem;
        transition: all 0.2s ease;
      }
      
      .message-actions button:hover {
        background: rgba(255,255,255,0.2);
        transform: translateY(-1px);
      }
      
      .chat-input-bar.black-glass { 
        padding: 1.2rem; 
        border-radius: 20px;
        background: rgba(5, 6, 10, 0.85);
        border: 1px solid rgba(255, 255, 255, 0.15);
        box-shadow: 
          0 20px 60px rgba(0, 0, 0, 0.8),
          0 8px 32px rgba(106, 130, 251, 0.1);
        backdrop-filter: blur(24px) saturate(120%);
        -webkit-backdrop-filter: blur(24px) saturate(120%);
      }
      
      .chat-input-bar textarea {
          background: rgba(255,255,255,0.08);
          border: 1px solid rgba(255,255,255,0.2);
          color:#fff;
          border-radius: 12px;
          padding: 1rem;
          font-size: 1rem;
          resize: none;
          min-height: 60px;
          transition: all 0.3s ease;
      }
      
      .chat-input-bar textarea:focus {
          outline: none;
          border-color: #6a82fb;
          box-shadow: 0 0 0 3px rgba(106, 130, 251, 0.2);
          background: rgba(255,255,255,0.12);
      }
      
      .chat-input-bar textarea::placeholder { 
          color: rgba(255,255,255,0.6); 
      }
      
      #forumSendBtn { 
          background: linear-gradient(135deg, #6a82fb 0%, #fc5c7d 100%); 
          color:#fff;
          border-radius: 12px;
          padding: 1rem 1.5rem;
          font-weight: 600;
          transition: all 0.3s ease;
      }
      
      #forumSendBtn:hover {
          transform: translateY(-2px);
          box-shadow: 0 8px 24px rgba(106, 130, 251, 0.3);
      }
      
      #emojiPicker { 
          background: rgba(5,6,10,0.9) !important; 
          border: 1px solid rgba(255,255,255,0.22) !important; 
          box-shadow: 0 16px 48px rgba(0,0,0,0.8) !important; 
          color:#fff !important; 
          backdrop-filter: blur(20px) !important; 
          -webkit-backdrop-filter: blur(20px) !important;
          border-radius: 16px !important;
      } 
      
      #emojiPicker button { 
          color:#fff !important; 
          border-radius: 8px !important;
          transition: all 0.2s ease !important;
      }
      
      #emojiPicker button:hover {
          background: rgba(255,255,255,0.1) !important;
          transform: translateY(-1px) !important;
      }
      
      #mentionSuggestions { 
          background: rgba(5,6,10,0.9); 
          border: 1px solid rgba(255,255,255,0.22); 
          color:#fff; 
          backdrop-filter: blur(20px); 
          -webkit-backdrop-filter: blur(20px);
          border-radius: 16px;
          box-shadow: 0 16px 48px rgba(0,0,0,0.8);
      } 
      
      .mention-suggestion { 
          border-bottom: 1px solid rgba(255,255,255,0.15); 
          padding: 0.75rem 1rem;
          transition: all 0.2s ease;
          cursor: pointer;
      }
      
      .mention-suggestion:hover, 
      .mention-suggestion.selected { 
          background: rgba(255,255,255,0.12); 
          transform: translateX(4px);
      }

      /* ChatGPT-style vertical popup */
      .category-popup {
          position: fixed;
          top: 0;
          left: 0;
          width: 320px;
          height: 100vh;
          background: rgba(10, 12, 20, 0.95);
          backdrop-filter: blur(20px) saturate(120%);
          -webkit-backdrop-filter: blur(20px) saturate(120%);
          border-right: 1px solid rgba(255, 255, 255, 0.15);
          z-index: 1000;
          transform: translateX(-100%);
          transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          overflow-y: auto;
          box-shadow: 4px 0 24px rgba(0, 0, 0, 0.3);
      }

      .category-popup.open {
          transform: translateX(0);
      }

      .category-popup-header {
          padding: 1.5rem;
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
          background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
          position: relative;
          overflow: hidden;
      }

      .category-popup-header::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 2px;
          background: linear-gradient(90deg, #6a82fb, #fc5c7d, #6a82fb);
          background-size: 200% 100%;
          animation: shimmer 3s ease-in-out infinite;
      }

      @keyframes shimmer {
          0%, 100% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
      }

      .category-popup-header h2 {
          color: #fff;
          margin: 0;
          font-size: 1.25rem;
          font-weight: 600;
          position: relative;
          z-index: 1;
      }

      .category-popup-header p {
          color: rgba(255, 255, 255, 0.7);
          margin: 0.5rem 0 0 0;
          font-size: 0.9rem;
          position: relative;
          z-index: 1;
      }

      .category-list {
          padding: 1rem;
      }

      .category-item {
          display: flex;
          align-items: center;
          padding: 0.75rem 1rem;
          margin-bottom: 0.5rem;
          background: rgba(255, 255, 255, 0.05);
          border: 1px solid rgba(255, 255, 255, 0.1);
          border-radius: 12px;
          cursor: pointer;
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          color: #fff;
          position: relative;
          overflow: hidden;
      }

      .category-item::before {
          content: '';
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
          transition: left 0.5s ease;
      }

      .category-item:hover::before {
          left: 100%;
      }

      .category-item:hover {
          background: rgba(255, 255, 255, 0.1);
          border-color: rgba(255, 255, 255, 0.2);
          transform: translateX(4px);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .category-item.active {
          background: linear-gradient(135deg, rgba(106, 130, 251, 0.2), rgba(252, 92, 125, 0.2));
          border-color: rgba(106, 130, 251, 0.4);
          box-shadow: 0 4px 12px rgba(106, 130, 251, 0.2);
          transform: translateX(4px);
      }

      .category-item.active::after {
          content: '✓';
          position: absolute;
          right: 1rem;
          color: #aef9e4;
          font-weight: bold;
          font-size: 1.1rem;
      }

      .category-item-content {
          flex: 1;
      }

      .category-name {
          font-weight: 600;
          margin-bottom: 0.25rem;
      }

      .category-badge {
          font-size: 0.75rem;
          padding: 0.2rem 0.5rem;
          border-radius: 6px;
          font-weight: 500;
          margin-left: 0.5rem;
      }

      .category-badge.paid {
          background: rgba(0, 200, 140, 0.2);
          color: #aef9e4;
          border: 1px solid rgba(0, 200, 140, 0.3);
      }

      .category-badge.unpaid {
          background: rgba(255, 255, 255, 0.15);
          color: #ffd2d2;
          border: 1px solid rgba(255, 255, 255, 0.25);
      }

      .category-toggle {
          position: fixed;
          top: 2rem;
          left: 2rem;
          z-index: 1001;
          background: rgba(10, 12, 20, 0.9);
          border: 1px solid rgba(255, 255, 255, 0.2);
          border-radius: 12px;
          padding: 0.75rem 1rem;
          cursor: pointer;
          color: #fff;
          font-weight: 500;
          backdrop-filter: blur(10px);
          -webkit-backdrop-filter: blur(10px);
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
          display: flex;
          align-items: center;
          gap: 0.5rem;
      }

      .category-toggle:hover {
          background: rgba(255, 255, 255, 0.1);
          transform: translateY(-1px);
          box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
      }

      .category-toggle.open {
          left: 340px;
          background: rgba(106, 130, 251, 0.2);
          border-color: rgba(106, 130, 251, 0.4);
      }

      .category-toggle::before {
          content: "📋";
          font-size: 1.1rem;
      }

      .category-toggle.open::before {
          content: "✕";
          font-size: 1.2rem;
      }

      .overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          background: rgba(0, 0, 0, 0.5);
          z-index: 999;
          opacity: 0;
          visibility: hidden;
          transition: all 0.3s ease;
      }

      .overlay.open {
          opacity: 1;
          visibility: visible;
      }

      @media (max-width: 768px) {
          .category-popup {
              width: 100vw;
          }
          .forum-shell.popup-open {
              margin-left: 0;
          }
          .category-toggle.open {
              left: auto;
              right: 2rem;
          }
      }
    </style>
  </head>
  <body data-user-role="{{ role|default('') }}" data-username="{{ username }}">
    <!-- Category Popup -->
    <div class="category-popup" id="categoryPopup">
      <div class="category-popup-header">
        <h2>Forum Topics</h2>
        <p>Select a topic to start chatting</p>
        <div class="user-info-section" style="margin-top: 1.5rem; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
          <div style="margin-bottom: 1rem;">
            <strong style="color: #8fa3ff; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em;">User Info</strong>
          </div>
          <div style="display: flex; flex-direction: column; gap: 0.75rem;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">Username:</span>
              <span style="color: #fff; font-weight: 600;">{{ username }}</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">Role:</span>
              <span class="class-chip" style="margin: 0;">{{ role }}</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">Status:</span>
              <span class="status-chip {{ 'unpaid' if (user_paid_status != 'paid') else '' }}" style="margin: 0;">{{ user_paid_status or 'unpaid' }}</span>
            </div>
          </div>
        </div>
      </div>
      <div class="category-list" id="categoryList">
        {% if paid_topics and paid_topics|length > 0 %}
          {% for t in paid_topics %}
            <div class="category-item" data-topic="{{ t[0] }}" data-topic-name="{{ t[1] }}">
              <div class="category-item-content">
                <div class="category-name">{{ t[1] }}</div>
              </div>
              <span class="category-badge paid">PAID</span>
            </div>
          {% endfor %}
        {% endif %}
        {% if unpaid_topics and unpaid_topics|length > 0 %}
          {% for t in unpaid_topics %}
            <div class="category-item" data-topic="{{ t[0] }}" data-topic-name="{{ t[1] }}">
              <div class="category-item-content">
                <div class="category-name">{{ t[1] }}</div>
              </div>
              <span class="category-badge unpaid">FREE</span>
            </div>
          {% endfor %}
        {% endif %}
        {% if (not paid_topics or paid_topics|length == 0) and (not unpaid_topics or unpaid_topics|length == 0) %}
          <div style="color:#e2e8f0; text-align:center; padding:2rem;">No topics available.</div>
        {% endif %}
      </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Category Toggle Button -->
    <button class="category-toggle" id="categoryToggle">
      Topics
    </button>

    <div class="forum-shell" id="forumShell">
      <header class="forum-header black-glass" style="margin-top: 5rem; padding:1.2rem 1.2rem 0.8rem 1.2rem;">
        <h1 style="margin:0;">Forum</h1>
        <p style="margin:0.4rem 0 0 0;">Logged in as <strong>{{ username }}</strong></p>
      </header>

      <section class="messages-container black-glass" id="forumMessages">
        <div id="emptyForumMsg" style="color:#888; text-align:center; padding:2rem;">
          Select a topic to view messages
        </div>
      </section>

      <section class="chat-input-bar black-glass" style="margin:1rem 0; display:flex; gap:.6rem; align-items:flex-end;">
        <textarea id="forumInput" placeholder="Type your message..." rows="1" style="flex:1; resize:none; border-radius:8px; padding:.6rem 0.8rem;"></textarea>
        <input type="file" id="forumMediaInput" accept="image/*,video/*" style="display:none;" />
        <button id="forumUploadBtn" class="btn" title="Upload media">📎</button>
        <button id="forumEmojiBtn" class="btn" title="Add emoji">😊</button>
        <button id="forumSendBtn" class="btn btn-primary" title="Send">➤</button>
      </section>

      <div id="forumMediaPreview" style="margin:0 0 1rem 0;"></div>

      <div id="mentionIndicator" style="display:none; color:#e2e8f0; font-size:0.9rem;">Type @ to mention someone</div>
      <div id="mentionHelp" style="display:none; color:#a0aec0; font-size:0.85rem; margin-top:0.25rem;">Use Arrow keys and Enter/Tab to select</div>
      <div id="mentionSuggestions" style="display:none; position:fixed; z-index:1000; border-radius:8px; overflow:hidden;">
        <div id="mentionSuggestionsList"></div>
      </div>
    </div>

    <!-- Poll Builder Modal -->
    <div id="pollModal" style="display:none; position:fixed; inset:0; z-index:1100;">
      <div id="pollModalBackdrop" style="position:absolute; inset:0; background: rgba(0,0,0,0.6);"></div>
      <div style="position:relative; max-width:560px; margin:10vh auto; background: rgba(15,18,28,0.9); color:#fff; border:1px solid rgba(255,255,255,0.15); border-radius:16px; box-shadow: 0 20px 60px rgba(0,0,0,0.6);">
        <div style="display:flex; justify-content:space-between; align-items:center; padding:1rem 1.25rem; border-bottom:1px solid rgba(255,255,255,0.12);">
          <h3 style="margin:0; font-size:1.1rem;">Create Poll</h3>
          <button id="pollCloseBtn" style="background:none; border:none; color:#fff; font-size:1.4rem; cursor:pointer;">×</button>
        </div>
        <div style="padding:1rem 1.25rem; display:flex; flex-direction:column; gap:0.75rem;">
          <label style="font-size:0.9rem; opacity:0.9;">Question</label>
          <input id="pollQuestion" type="text" placeholder="Type your poll question" style="background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.2); color:#fff; border-radius:10px; padding:0.7rem;">
          <div id="pollOptionsContainer" style="display:flex; flex-direction:column; gap:0.5rem; margin-top:0.5rem;">
            <div class="poll-option-row" style="display:flex; gap:0.5rem;">
              <input type="text" class="poll-option" placeholder="Option 1" style="flex:1; background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.2); color:#fff; border-radius:10px; padding:0.6rem;">
              <button class="poll-remove" style="background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); color:#fff; border-radius:10px; padding:0.4rem 0.6rem; cursor:pointer;">🗑️</button>
            </div>
            <div class="poll-option-row" style="display:flex; gap:0.5rem;">
              <input type="text" class="poll-option" placeholder="Option 2" style="flex:1; background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.2); color:#fff; border-radius:10px; padding:0.6rem;">
              <button class="poll-remove" style="background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); color:#fff; border-radius:10px; padding:0.4rem 0.6rem; cursor:pointer;">🗑️</button>
            </div>
          </div>
          <div style="display:flex; gap:0.5rem;">
            <button id="pollAddOptionBtn" style="background:rgba(106,130,251,0.2); border:1px solid rgba(106,130,251,0.5); color:#aef; border-radius:10px; padding:0.5rem 0.8rem; cursor:pointer;">+ Add option</button>
          </div>
          <div style="display:flex; justify-content:flex-end; gap:0.6rem; margin-top:0.5rem;">
            <button id="pollCancelBtn" style="background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.2); color:#fff; border-radius:10px; padding:0.6rem 0.9rem; cursor:pointer;">Cancel</button>
            <button id="pollCreateBtn" style="background:linear-gradient(135deg, #6a82fb 0%, #fc5c7d 100%); border:none; color:#fff; border-radius:10px; padding:0.6rem 0.95rem; cursor:pointer; font-weight:600;">Insert poll</button>
          </div>
        </div>
      </div>
    </div>

    <script src="attached_assets/theme.js"></script>
    <script src="forum.js"></script>
    
    <!-- Footer -->
    <footer class="footer">
      <div class="container footer-content">
        <div class="footer-social">
          <a href="https://www.instagram.com/sunrise_education_centre?igsh=OGc5enlsanE0eWJ2" target="_blank">Instagram</a>
          <a href="https://www.youtube.com/@MohitNariyani" target="_blank">YouTube</a>
        </div>
        <div class="footer-links">
          <a href="#">Privacy Policy</a>
          <a href="#">Contact Us</a>
        </div>
        <div class="footer-copy">&copy; 2024 Sunrise Education Centre</div>
      </div>
    </footer>
  </body>
</html>
