<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forum - Sunrise Educational Centre</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="floating-navbar.css">
    <link rel="stylesheet" href="uiverse-components.css">
    <link rel="stylesheet" href="forum.css">
    <link rel="stylesheet" href="enhanced-aesthetic.css">
    <link rel="stylesheet" href="modern-components.css">
    <link rel="stylesheet" href="modern-navbar.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Optimized Forum Styles */
        .forum-page {
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        body.dark-mode .forum-page {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: white;
        }

        .forum-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 2rem;
            position: relative;
            z-index: 10;
        }

        .forum-hero {
            padding: 8rem 0 4rem 0;
            text-align: center;
            position: relative;
            z-index: 20;
        }

        .forum-hero-content {
            max-width: 1000px;
            margin: 0 auto;
        }

        .forum-logo {
            width: 120px;
            height: 120px;
            border-radius: 30px;
            background: linear-gradient(135deg, #6a82fb 0%, #fc5c7d 50%, #ff6b35 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 2rem;
            font-size: 3rem;
            animation: logoFloat 3s ease-in-out infinite;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 0 40px rgba(106,130,251,0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .forum-title {
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #fff 0%, #e0e7ff 50%, #c7d2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .forum-subtitle {
            font-size: clamp(1.1rem, 2.5vw, 1.4rem);
            color: rgba(255,255,255,0.9);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .user-info-card {
            background: rgba(5, 6, 10, 0.72);
            border: 1px solid rgba(255, 255, 255, 0.22);
            border-radius: 20px;
            padding: 1.5rem 2rem;
            margin: 2rem auto;
            max-width: 600px;
            backdrop-filter: blur(18px) saturate(110%);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6a82fb 0%, #fc5c7d 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
        }

        .user-details h3 {
            margin: 0 0 0.25rem 0;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .user-details p {
            margin: 0;
            color: rgba(255,255,255,0.7);
            font-size: 1rem;
        }

        .user-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .status-paid {
            background: rgba(0,200,140,0.2);
            border: 1px solid rgba(0,200,140,0.4);
            color: #aef9e4;
        }

        .status-free {
            background: rgba(255,215,0,0.2);
            border: 1px solid rgba(255,215,0,0.4);
            color: #ffd700;
        }

        .forum-main {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            margin: 2rem 0;
            position: relative;
            z-index: 15;
        }

        .messages-area {
            background: rgba(5, 6, 10, 0.72);
            border: 1px solid rgba(255, 255, 255, 0.22);
            border-radius: 24px;
            padding: 2rem;
            min-height: 60vh;
            max-height: 75vh;
            overflow-y: auto;
            backdrop-filter: blur(18px) saturate(110%);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6);
            position: relative;
        }

        .messages-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #6a82fb, #fc5c7d, #ff6b35, #6a82fb);
            background-size: 300% 100%;
            animation: shimmer 3s ease infinite;
            border-radius: 24px 24px 0 0;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            animation: bounce 2s ease-in-out infinite;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }

        .empty-state h3 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #6a82fb 0%, #fc5c7d 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .empty-state p {
            font-size: 1.1rem;
            color: rgba(255,255,255,0.8);
            margin-bottom: 2rem;
            line-height: 1.6;
            max-width: 500px;
        }

        .input-area {
            background: rgba(5, 6, 10, 0.72);
            border: 1px solid rgba(255, 255, 255, 0.22);
            border-radius: 20px;
            padding: 1.5rem;
            margin-top: 2rem;
            backdrop-filter: blur(18px) saturate(110%);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6);
            position: relative;
        }

        .input-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #6a82fb, #fc5c7d);
            border-radius: 20px 20px 0 0;
        }

        .input-container {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
        }

        .input-field {
            flex: 1;
        }

        .input-field label {
            display: block;
            color: rgba(255,255,255,0.9);
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .input-field textarea {
            width: 100%;
            min-height: 60px;
            max-height: 120px;
            padding: 1rem;
            border-radius: 12px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            font-size: 1rem;
            line-height: 1.5;
            resize: vertical;
            font-family: inherit;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .input-field textarea:focus {
            outline: none;
            border-color: #6a82fb;
            box-shadow: 0 0 0 3px rgba(106,130,251,0.2);
            background: rgba(255,255,255,0.12);
        }

        .input-field textarea::placeholder {
            color: rgba(255,255,255,0.6);
        }

        .input-actions {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .action-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .action-btn-glass {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
        }

        .action-btn-glass:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
        }

        .action-btn-primary {
            background: linear-gradient(135deg, #6a82fb 0%, #fc5c7d 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(106,130,251,0.3);
        }

        .action-btn-primary:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 25px rgba(106,130,251,0.4);
        }

        .topics-toggle {
            position: fixed;
            top: 2rem;
            left: 2rem;
            z-index: 1001;
            background: rgba(5, 6, 10, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 1rem 1.5rem;
            color: white;
            font-weight: 600;
            cursor: pointer;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .topics-toggle:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.4);
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        @keyframes shimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @media (max-width: 768px) {
            .forum-hero {
                padding: 6rem 0 3rem 0;
            }
            
            .forum-logo {
                width: 80px;
                height: 80px;
                font-size: 2rem;
            }
            
            .user-info-card {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
            
            .input-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .input-actions {
                flex-direction: row;
                justify-content: center;
            }
            
            .topics-toggle {
                top: 1rem;
                left: 1rem;
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            .messages-area {
                min-height: 50vh;
                max-height: 60vh;
            }
        }
    </style>
</head>
<body class="forum-page" data-user-role="{{ role|default('') }}">
    
    <!-- Enhanced Floating Particles Background -->
    <div class="floating-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <!-- Topics Toggle Button -->
    <button class="topics-toggle" id="categoryToggle">
        <span>💬</span>
        <span>Browse Topics</span>
    </button>

    <!-- Debug Test Button (temporary) -->
    <button onclick="testPopup()" style="position: fixed; top: 100px; right: 20px; z-index: 1001; background: #ff6b6b; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; display: none;">
        Test Popup
    </button>

    <!-- Enhanced Category Popup -->
    <div class="category-popup glass-card" id="categoryPopup">
        <div class="category-popup-header glass-card" style="margin: 0; border-radius: 20px 20px 0 0;">
            <div style="text-align: center; margin-bottom: 1.5rem;">
                <h2 style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-size: 1.5rem; margin-bottom: 0.5rem;">💬 Forum Topics</h2>
                <p style="color: rgba(255,255,255,0.8); font-size: 1rem;">Select a topic to start chatting</p>
            </div>
            
            <div class="user-info-section glass-card" style="margin-top: 1.5rem; padding: 1.5rem; background: rgba(255,255,255,0.08); border-radius: 16px; border: 1px solid rgba(255,255,255,0.15); position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: var(--primary-gradient);"></div>
                <div style="margin-bottom: 1.2rem; text-align: center;">
                    <div style="width: 60px; height: 60px; border-radius: 50%; background: var(--primary-gradient); display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 1.5rem; font-weight: 700; color: white;">{{ username[0]|upper if username else 'U' }}</div>
                    <strong style="color: #fff; font-size: 1rem; text-transform: uppercase; letter-spacing: 0.05em;">{{ username }}</strong>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 12px;">
                        <div style="color: rgba(255,255,255,0.7); font-size: 0.8rem; margin-bottom: 0.5rem;">Role</div>
                        <span class="class-chip" style="margin: 0; padding: 0.5rem 1rem; background: rgba(106,130,251,0.2); border: 1px solid rgba(106,130,251,0.4);">{{ role }}</span>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 12px;">
                        <div style="color: rgba(255,255,255,0.7); font-size: 0.8rem; margin-bottom: 0.5rem;">Status</div>
                        <span class="status-chip {{ 'unpaid' if (user_paid_status != 'paid') else '' }}" style="margin: 0; padding: 0.5rem 1rem;">{{ user_paid_status or 'unpaid' }}</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="category-list" id="categoryList">
            {% if paid_topics and paid_topics|length > 0 %}
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: #aef9e4; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <span>💎</span> Premium Topics
                    </h4>
                    {% for t in paid_topics %}
                        <div class="category-item glass-card" data-topic="{{ t[0] }}" data-topic-name="{{ t[1] }}" style="margin-bottom: 0.75rem; background: rgba(0, 200, 140, 0.1); border: 1px solid rgba(0, 200, 140, 0.3);">
                            <div class="category-item-content">
                                <div class="category-name" style="display: flex; align-items: center; gap: 0.75rem;">
                                    <span style="font-size: 1.2rem;">💬</span>
                                    <span>{{ t[1] }}</span>
                                </div>
                            </div>
                            <span class="category-badge paid" style="background: rgba(0, 200, 140, 0.3); color: #aef9e4; border: 1px solid rgba(0, 200, 140, 0.5); padding: 0.25rem 0.75rem; border-radius: 12px;">PREMIUM</span>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
            
            {% if unpaid_topics and unpaid_topics|length > 0 %}
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: rgba(255,255,255,0.8); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <span>🆓</span> Free Topics
                    </h4>
                    {% for t in unpaid_topics %}
                        <div class="category-item glass-card" data-topic="{{ t[0] }}" data-topic-name="{{ t[1] }}" style="margin-bottom: 0.75rem;">
                            <div class="category-item-content">
                                <div class="category-name" style="display: flex; align-items: center; gap: 0.75rem;">
                                    <span style="font-size: 1.2rem;">💭</span>
                                    <span>{{ t[1] }}</span>
                                </div>
                            </div>
                            <span class="category-badge unpaid" style="background: rgba(255, 255, 255, 0.15); color: #ffd2d2; border: 1px solid rgba(255, 255, 255, 0.25); padding: 0.25rem 0.75rem; border-radius: 12px;">FREE</span>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
            
            {% if (not paid_topics or paid_topics|length == 0) and (not unpaid_topics or unpaid_topics|length == 0) %}
                <div class="glass-card" style="color: rgba(255,255,255,0.8); text-align: center; padding: 2rem; background: rgba(255,255,255,0.05);">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">💬</div>
                    <div style="font-size: 1.1rem; margin-bottom: 0.5rem;">No topics available</div>
                    <div style="font-size: 0.9rem; opacity: 0.7;">Check back later for new discussion topics</div>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Main Forum Container -->
    <div class="forum-container">
        
        <!-- Hero Section -->
        <section class="forum-hero">
            <div class="forum-hero-content">
                <div class="forum-logo">💬</div>
                <h1 class="forum-title">Community Forum</h1>
                <p class="forum-subtitle">Connect, discuss, and learn together in our vibrant educational community</p>
                
                <!-- User Info Card -->
                <div class="user-info-card">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div class="user-avatar">{{ username[0]|upper if username else 'U' }}</div>
                        <div class="user-details">
                            <h3>{{ username }}</h3>
                            <p>{{ role|title }}</p>
                        </div>
                    </div>
                    <div class="user-status {{ 'status-paid' if user_paid_status == 'paid' else 'status-free' }}">
                        {{ '💎 Premium' if user_paid_status == 'paid' else '🆓 Free' }}
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Forum Content -->
        <main class="forum-main">
            
            <!-- Messages Display Area -->
            <section class="messages-area" id="forumMessages">
                <div id="emptyForumMsg" class="empty-state">
                    <div class="empty-state-icon">💭</div>
                    <h3>Ready to Start Chatting?</h3>
                    <p>Select a topic from the sidebar to join conversations, share knowledge, and connect with your classmates and teachers in real-time discussions.</p>
                    <button onclick="document.getElementById('categoryToggle').click()" class="action-btn action-btn-primary" style="width: auto; height: auto; padding: 1rem 2rem; border-radius: 50px; font-size: 1.1rem;">
                        <span style="margin-right: 0.5rem;">💬</span>
                        Browse Topics
                    </button>
                </div>
            </section>

            <!-- Input Area -->
            <section class="input-area">
                <div class="input-container">
                    <div class="input-field">
                        <label for="forumInput">💬 Share your thoughts</label>
                        <textarea id="forumInput" placeholder="Type your message here... Share ideas, ask questions, or join the discussion!" rows="3"></textarea>
                    </div>
                    
                    <div class="input-actions">
                        <input type="file" id="forumMediaInput" accept="image/*,video/*" style="display:none;" />
                        <button id="forumUploadBtn" class="action-btn action-btn-glass" title="Upload media">📎</button>
                        <button id="forumEmojiBtn" class="action-btn action-btn-glass" title="Add emoji">😊</button>
                        <button id="forumSendBtn" class="action-btn action-btn-primary" title="Send message">➤</button>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Poll Creation Modal -->
    <div id="pollModal" class="modal" style="display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7);">
        <div class="modal-content black-glass" style="margin: 5% auto; padding: 2rem; border-radius: 20px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="color: white; margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                    📊 Create Poll
                </h2>
                <button onclick="closePollModal()" style="background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; padding: 0.5rem;">✕</button>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; color: white; margin-bottom: 0.5rem; font-weight: 600;">Poll Question</label>
                <input type="text" id="pollQuestion" placeholder="What would you like to ask?" style="width: 100%; padding: 12px; border: none; border-radius: 10px; background: rgba(255,255,255,0.1); color: white; font-size: 1rem;">
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; color: white; margin-bottom: 0.5rem; font-weight: 600;">Poll Options</label>
                <div id="pollOptions">
                    <div class="poll-option-input" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <input type="text" placeholder="Option 1" style="flex: 1; padding: 10px; border: none; border-radius: 8px; background: rgba(255,255,255,0.1); color: white;">
                        <button onclick="removePollOption(this)" style="background: rgba(255,0,0,0.2); border: 1px solid rgba(255,0,0,0.4); color: #ff6b6b; padding: 10px; border-radius: 8px; cursor: pointer;">🗑️</button>
                    </div>
                    <div class="poll-option-input" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <input type="text" placeholder="Option 2" style="flex: 1; padding: 10px; border: none; border-radius: 8px; background: rgba(255,255,255,0.1); color: white;">
                        <button onclick="removePollOption(this)" style="background: rgba(255,0,0,0.2); border: 1px solid rgba(255,0,0,0.4); color: #ff6b6b; padding: 10px; border-radius: 8px; cursor: pointer;">🗑️</button>
                    </div>
                </div>
                <button onclick="addPollOption()" class="uiverse-btn" style="margin-top: 0.5rem; padding: 8px 16px; font-size: 0.9rem;">
                    ➕ Add Option
                </button>
            </div>
            
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button onclick="closePollModal()" class="morph-btn" style="padding: 12px 24px;">Cancel</button>
                <button onclick="createPoll()" class="pulse-btn" style="padding: 12px 24px;">Create Poll</button>
            </div>
        </div>
    </div>

    <!-- Mention Suggestions Dropdown -->
    <div id="mentionSuggestions" class="mention-suggestions black-glass" style="display: none; position: fixed; z-index: 9999; border-radius: 12px; padding: 0.5rem; max-height: 200px; overflow-y: auto; box-shadow: 0 8px 32px rgba(0,0,0,0.6);">
        <div id="mentionSuggestionsList">
            <!-- Suggestions will be populated here -->
        </div>
    </div>

    <!-- Mention Help Indicator -->
    <div id="mentionIndicator" style="display: none; position: fixed; bottom: 100px; right: 20px; background: rgba(106,130,251,0.9); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem; z-index: 1000;">
        💡 Type @ to mention users
    </div>

    <!-- Command Help Panel -->
    <div id="commandHelp" class="black-glass" style="display: none; position: fixed; bottom: 120px; left: 20px; padding: 1rem; border-radius: 12px; max-width: 300px; z-index: 1000;">
        <h4 style="color: white; margin: 0 0 0.5rem 0; font-size: 0.9rem;">💡 Quick Commands</h4>
        <div style="color: rgba(255,255,255,0.8); font-size: 0.8rem; line-height: 1.4;">
            <div><strong>/poll</strong> - Create a poll</div>
            <div><strong>@username</strong> - Mention a user</div>
            <div><strong>Ctrl+Enter</strong> - Send message</div>
        </div>
    </div>

    <!-- Enhanced Footer -->
    <footer class="footer-modern">
        <div class="container">
            <div class="footer-content-modern">
                <div class="footer-section">
                    <h3>Community Forum</h3>
                    <p>Connect, learn, and grow together in our educational community.</p>
                    <div class="footer-social-modern">
                        <a href="https://www.instagram.com/sunrise_education_centre?igsh=OGc5enlsanE0eWJ2" target="_blank" class="social-link-modern">📸</a>
                        <a href="https://www.youtube.com/@MohitNariyani" target="_blank" class="social-link-modern">🎥</a>
                        <a href="/" class="social-link-modern">🏠</a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <a href="/">Home</a>
                        <a href="/study-resources">Study Resources</a>
                        <a href="/online-class">Live Classes</a>
                        <a href="/admission">Admission</a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Forum Guidelines</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <span>💬 Be respectful</span>
                        <span>📚 Stay on topic</span>
                        <span>🤝 Help others</span>
                        <span>🚫 No spam</span>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <div>&copy; 2024 Sunrise Educational Centre. All rights reserved.</div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
        window.currentUsername = {{ username|tojson }};
        
        // Forum page debugging and fallback
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Forum page loaded');
            
            // Test if all elements are present
            const requiredElements = {
                categoryToggle: document.getElementById('categoryToggle'),
                categoryPopup: document.getElementById('categoryPopup'),
                overlay: document.getElementById('overlay'),
                forumMessages: document.getElementById('forumMessages')
            };
            
            console.log('Required elements check:', requiredElements);
            
            // Fallback event listener if forum.js fails
            setTimeout(() => {
                const toggle = document.getElementById('categoryToggle');
                const popup = document.getElementById('categoryPopup');
                const overlay = document.getElementById('overlay');
                
                if (toggle && popup && overlay && !toggle.hasAttribute('data-listener-added')) {
                    console.log('Adding fallback event listeners');
                    
                    toggle.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Fallback: Toggle clicked');
                        
                        const isOpen = popup.classList.contains('open');
                        if (isOpen) {
                            popup.classList.remove('open');
                            overlay.classList.remove('open');
                            document.body.classList.remove('popup-open');
                        } else {
                            popup.classList.add('open');
                            overlay.classList.add('open');
                            document.body.classList.add('popup-open');
                        }
                    });
                    
                    overlay.addEventListener('click', function() {
                        console.log('Fallback: Overlay clicked');
                        popup.classList.remove('open');
                        overlay.classList.remove('open');
                        document.body.classList.remove('popup-open');
                    });
                    
                    toggle.setAttribute('data-listener-added', 'true');
                    console.log('Fallback event listeners added successfully');
                }
            }, 1000);
        });
    </script>
    
    <script src="modern-interactions.js"></script>
    <script src="modern-navbar.js"></script>
    <script src="forum.js"></script>

    <!-- Modern Button Navbar (User Pages Only) -->
    {% if username and role not in ['admin', 'teacher'] %}
    <nav class="modern-navbar">
        <div class="button-container">
            <!-- Home Button -->
            <button class="button" data-tooltip="Home" onclick="navigateTo('/')">
                <svg class="icon" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                    <path d="M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 0 0-44.4 0L77.5 505a63.9 63.9 0 0 0-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0 0 18.7-45.3c0-17-6.7-33.1-18.8-45.2zM568 868H456V664h112v204zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3h-96.1z"></path>
                </svg>
            </button>
            
            <!-- Search Button -->
            <button class="button" data-tooltip="Search" onclick="openSearch()">
                <svg class="icon" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </button>
            
            <!-- Profile Button -->
            <button class="button" data-tooltip="Profile" onclick="navigateTo('/profile')">
                <svg class="icon" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2.5a5.5 5.5 0 0 1 3.096 10.047 9.005 9.005 0 0 1 5.9 8.181.75.75 0 1 1-1.499.044 7.5 7.5 0 0 0-14.993 0 .75.75 0 0 1-1.5-.045 9.005 9.005 0 0 1 5.9-8.18A5.5 5.5 0 0 1 12 2.5ZM8 8a4 4 0 1 0 8 0 4 4 0 0 0-8 0Z"></path>
                </svg>
            </button>
            
            <!-- Resources Button -->
            <button class="button" data-tooltip="Resources" onclick="navigateTo('/study-resources')">
                <svg class="icon" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                </svg>
            </button>
            
            <!-- Forum Button -->
            <button class="button active" data-tooltip="Forum" onclick="navigateTo('/forum')">
                <svg class="icon" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"></path>
                </svg>
            </button>
        </div>
    </nav>
    {% endif %}


    <!-- Search Modal -->
    <div id="searchModal" class="modal" style="display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
        <div class="modal-content black-glass" style="margin: 10% auto; padding: 2rem; border-radius: 20px; width: 90%; max-width: 600px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="color: white; margin: 0;">🔍 Search</h2>
                <button onclick="closeSearch()" style="background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer;">✕</button>
            </div>
            <input type="text" id="searchInput" placeholder="Search courses, resources, or topics..." style="width: 100%; padding: 15px; border: none; border-radius: 10px; background: rgba(255,255,255,0.1); color: white; font-size: 1rem; margin-bottom: 1rem;">
            <div id="searchResults" style="max-height: 300px; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- Notification Panel -->
    <div id="notification-panel" class="notification-panel black-glass" style="display: none; position: fixed; top: 100px; right: 20px; width: 350px; max-height: 500px; overflow-y: auto; z-index: 999; border-radius: 16px; padding: 1rem; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.2);">
            <h3 style="margin: 0; font-size: 1.2rem; color: white;">🔔 Notifications</h3>
            <button onclick="toggleNotifications()" style="background: none; border: none; color: #fff; font-size: 1.2rem; cursor: pointer; padding: 0.2rem;">✕</button>
        </div>
        <div class="notification-list">
            <div class="notification-item" style="padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 0.5rem;">
                <div style="font-weight: 600; margin-bottom: 0.3rem; color: white;">📚 Latest Updates</div>
                <div style="font-size: 0.9rem; opacity: 0.8; color: rgba(255,255,255,0.8);">Check out new features and content</div>
            </div>
        </div>
    </div>

    <script src="navbar-functions.js"></script>
</body>
</html>