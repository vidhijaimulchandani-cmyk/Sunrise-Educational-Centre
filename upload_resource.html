<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Upload Resource - Admin</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="bulk_upload/bulk_upload.css">
  <script src="script.js"></script>
  <link rel="stylesheet" href="admin-modern.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      backdrop-filter: blur(5px);
    }
    
    .modal-content {
      background: #fff;
      margin: 5% auto;
      padding: 0;
      border-radius: 12px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      animation: modalSlideIn 0.3s ease-out;
    }
    
    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .modal-header {
      background: linear-gradient(135deg, #6a82fb 0%, #fc5c7d 100%);
      color: white;
      padding: 1.5rem;
      border-radius: 12px 12px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-header h2 {
      margin: 0;
      font-size: 1.5rem;
    }
    
    .close {
      color: white;
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    
    .close:hover {
      opacity: 0.7;
    }
    
    .modal-content form {
      padding: 2rem;
    }
    
    .modal-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 2rem;
      padding-top: 1rem;
      border-top: 1px solid #e0e7ff;
    }
    
    /* Flash message styles */
    .flash-message {
      margin-bottom: 1rem;
      padding: 1rem;
      border-radius: 8px;
      color: #fff;
    }
    
    .flash-error {
      background: #fc5c7d;
    }
    
    .flash-success {
      background: #28a745;
    }
    
    /* Dark Mode Styles */
    body.dark-mode {
      background: #1a1a2e;
      color: #fff;
    }
    
    body.dark-mode .upload-container {
      background: #232946;
    }
    
    body.dark-mode .header-section h1 {
      color: #fff;
    }
    
    body.dark-mode .header-section p {
      color: #b8c5d6;
    }
    
    body.dark-mode .tab-container {
      background: #2a2a3a;
    }
    
    body.dark-mode .tab-btn {
      color: #b8c5d6;
    }
    
    body.dark-mode .tab-btn.active {
      background: #6a82fb;
      color: #fff;
    }
    
    body.dark-mode .tab-btn:hover:not(.active) {
      background: rgba(106,130,251,0.2);
    }
    
    body.dark-mode .tab-content {
      background: #232946;
      box-shadow: 0 4px 24px rgba(100,100,255,0.15);
    }
    
    body.dark-mode .form-group label {
      color: #fff;
    }
    
    body.dark-mode .form-group input,
    body.dark-mode .form-group select,
    body.dark-mode .form-group textarea {
      background: #1a1a2e;
      border-color: #3a3a4a;
      color: #fff;
    }
    
    body.dark-mode .form-group input:focus,
    body.dark-mode .form-group select:focus,
    body.dark-mode .form-group textarea:focus {
      border-color: #6a82fb;
    }
    
    body.dark-mode .resource-card {
      background: #2a2a3a;
      border-color: #3a3a4a;
    }
    
    body.dark-mode .file-upload-area {
      border-color: #3a3a4a;
      background: #1a1a2e;
    }
    
    body.dark-mode .file-upload-area:hover {
      border-color: #6a82fb;
      background: #2a2a3a;
    }
    
    body.dark-mode .modal-content {
      background: #232946;
    }
    
    body.dark-mode .modal-content form {
      background: #232946;
    }
  </style>
    <link rel="stylesheet" href="floating-navbar.css">
    <link rel="stylesheet" href="uiverse-components.css">
</head>
<body>
  <nav class="navbar glassmorphic">
    <div class="container nav-content">
      <div class="nav-logo">
        <img src="attached_assets/image_1750584670920.png" alt="Logo">
      </div>
      <ul class="nav-links">
        <li><a href="/admin">Admin Panel</a></li>
        <li><a href="/logout" class="btn btn-primary">Logout</a></li>
      </ul>
    </div>
  </nav>

  <main class="container main-content">
    <div class="upload-container">
      <a href="/admin" class="back-link">&larr; Back to Admin Panel</a>
      
      <div class="header-section">
        <h1>üìÅ Resource Management</h1>
        <p>Upload, schedule, and manage all your educational resources</p>
      </div>
      
      <div class="tab-container">
        <button class="tab-btn active" onclick="showTab('upload')">üì§ Upload Resources</button>
        <button class="tab-btn" onclick="showTab('bulk-upload')">üöÄ Bulk Upload</button>
        <button class="tab-btn" onclick="showTab('smart-upload-tab')">ü§ñ Smart Upload</button>
        <button class="tab-btn" onclick="showTab('categories-tab')">üìÅ Categories</button>
        <button class="tab-btn" onclick="showTab('analytics-tab')">üìä Analytics</button>
        <button class="tab-btn" onclick="showTab('scheduled-tab')">‚è∞ Scheduled</button>
        <button class="tab-btn" onclick="showTab('history-tab')">üìö History</button>
        <button class="tab-btn" onclick="showTab('settings-tab')">‚öôÔ∏è Settings</button>
      </div>
      
      <!-- Upload Resource Tab -->
      <div id="upload-tab" class="tab-content active">
      <h2>Upload New Resource</h2>
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
              <div class="flash-message flash-{{ category }}">{{ message }}</div>
          {% endfor %}
      {% endif %}
      {% endwith %}
      <form method="POST" action="/upload-resource" enctype="multipart/form-data" class="login-form">
          <div class="form-grid">
            <div class="form-group">
              <label for="title">Resource Title *</label>
              <input type="text" id="title" name="title" placeholder="e.g., Algebra Chapter 5 Notes" required>
            </div>
            <div class="form-group">
              <label for="category">Category *</label>
              <select id="category" name="category" required>
                <option value="">Select Category</option>
                <!-- Default Categories -->
                <option value="notes">Notes</option>
                <option value="worksheet">Worksheet</option>
                <option value="formula">Formula Sheet</option>
                <option value="practice_test">Practice Test</option>
                <option value="reference_book">Reference Book</option>
                <option value="video">Video</option>
                <option value="other">Other</option>
                <!-- Dynamic Categories -->
                {% for category in categories %}
                  <option value="{{ category[1] }}">{{ category[1] }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="form-group">
              <label for="class_id">Target Class *</label>
              <select id="class_id" name="class_id" required>
                <option value="">Select Class</option>
          {% for id, name in all_classes %}
            <option value="{{ id }}">{{ name|title }}</option>
          {% endfor %}
        </select>
            </div>
            <div class="form-group">
              <label for="paid_status">Paid Status</label>
              <select id="paid_status" name="paid_status">
                <option value="unpaid">Free</option>
                <option value="paid">Paid</option>
        </select>
            </div>
          </div>
          
          <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" name="description" placeholder="Brief description of the resource content..."></textarea>
          </div>
          
          <div class="form-group">
            <label for="schedule_date">Schedule Upload (Optional)</label>
            <input type="datetime-local" id="schedule_date" name="schedule_date">
            <small style="color: #666;">Leave empty to upload immediately</small>
          </div>
          
          <div class="file-upload-area" id="fileUploadArea">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
            <h3>Drop files here or click to upload</h3>
            <p style="color: #666; margin-bottom: 1rem;">Supports PDF, DOC, PPT, MP4, and other educational formats</p>
            <input type="file" id="file" name="file" accept=".pdf,.doc,.docx,.ppt,.pptx,.mp4,.jpg,.jpeg,.png" required style="display: none;">
            <button type="button" class="btn-primary" onclick="document.getElementById('file').click()">Choose File</button>
          </div>
          
          <div id="fileInfo" style="display: none; background: #f8f9ff; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
            <strong>Selected File:</strong> <span id="fileName"></span>
          </div>
          
        <div style="margin:1rem 0; display:flex; align-items:center; gap:0.6rem; color:#9ca3af;">
          <span style="height:1px; background:#e5e7eb; flex:1;"></span>
          <span>or</span>
          <span style="height:1px; background:#e5e7eb; flex:1;"></span>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label for="resource_url">Upload via URL / Google Drive Link</label>
            <input type="url" id="resource_url" name="resource_url" placeholder="Paste public URL or Google Drive share link here">
            <small style="color:#6b7280;">Make sure the link is publicly accessible. For Google Drive, set sharing to "Anyone with the link".</small>
          </div>
        </div>

        <button type="submit" class="btn btn-primary" style="margin-top:1rem;">Upload Resource</button>
      </form>
      </div>
      

      
      <!-- Bulk Upload Tab -->
      <div id="bulk-upload-tab" class="tab-content">
        <h2>Bulk Upload Study Resources</h2>
        <div class="bulk-upload-container">
          <!-- Excel Upload Section -->
          <div class="excel-upload-section">
            <div class="upload-area" id="excel-upload-area">
              <input type="file" id="excel-input" accept=".xlsx,.xls" style="display:none">
              <div class="upload-icon" style="font-size:2rem;margin-bottom:0.5rem;">üìÑ</div>
              <h3>Bulk Upload from xlsx Folder or Drag & Drop Excel</h3>
              <p>Place your Excel file in the <b>xlsx</b> folder in the project directory, or drag and drop it here.</p>
              <button class="btn btn-secondary" id="scan-xlsx-btn">Scan xlsx Folder</button>
              <div id="xlsx-file-list" style="margin-top:1rem;"></div>
            </div>

            <div class="template-download" style="margin-top:1rem;">
              <h4>Download Template</h4>
              <p>Use our Excel template to ensure correct format for study resources</p>
              <button class="btn btn-outline" id="download-template-btn">Download Study Resources Template</button>
            </div>
          </div>

          <!-- File Preview Section -->
          <div class="file-preview" id="file-preview" style="display: none;">
            <h4>Study Resources to Upload</h4>
            <div class="preview-info" id="preview-info"></div>
            <div class="preview-filters" style="display:flex; gap:0.75rem; flex-wrap:wrap; align-items:center; margin: 0 0 1rem 0;">
              <input id="filter-search" type="text" placeholder="Search title or class..." style="flex:1; min-width:220px; padding:0.6rem 0.8rem; border:1px solid #e2e8f0; border-radius:8px;" />
              <label style="display:flex; gap:0.4rem; align-items:center;"><input type="checkbox" id="filter-duplicates"> Show duplicates only</label>
              <label style="display:flex; gap:0.4rem; align-items:center;"><input type="checkbox" id="filter-missing"> Show missing files only</label>
              <button class="btn btn-secondary" id="recheck-duplicates-btn">Recheck</button>
            </div>
            <div class="preview-table-container">
              <table class="preview-table" id="preview-table">
                <thead>
                  <tr>
                    <th>File Name</th>
                    <th>Title</th>
                    <th>Class</th>
                    <th>Category</th>
                    <th>Description</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody id="preview-tbody"></tbody>
              </table>
            </div>
            <div class="upload-actions" style="flex-wrap:wrap;">
              <label style="display:flex;align-items:center;gap:6px;"><input type="checkbox" id="opt-skip-duplicates" checked> Skip duplicates</label>
              <label style="display:flex;align-items:center;gap:6px;"><input type="checkbox" id="opt-skip-missing" checked> Skip missing files</label>
              <label style="display:flex;align-items:center;gap:6px;"><input type="checkbox" id="opt-dry-run"> Dry run (no save)</label>
              <button class="btn btn-secondary" id="export-errors-btn">‚¨áÔ∏è Export Errors CSV</button>
              <button class="btn btn-primary" id="confirm-upload-btn">‚úÖ Confirm & Upload</button>
              <button class="btn btn-outline" id="cancel-upload-btn">‚ùå Cancel</button>
            </div>
          </div>

          <!-- Progress Section -->
          <div class="upload-progress" id="upload-progress" style="display: none;">
            <div class="progress-header">
              <h4>Upload Progress</h4>
              <span class="progress-text" id="progress-text">0%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="progress-details" id="progress-details"></div>
          </div>

          <!-- Results Section -->
          <div class="upload-results" id="upload-results" style="display: none;">
            <div class="results-header">
              <h4>Upload Results</h4>
              <button class="btn btn-outline" id="close-results-btn">Close</button>
            </div>
            <div class="results-content" id="results-content"></div>
          </div>
        </div>
      </div>

      
      <!-- Manage Categories Tab -->
      <div id="categories-tab" class="tab-content">
        <h2>Manage Categories</h2>
        <p style="color: #666; margin-bottom: 2rem;">Create and manage categories for organizing your educational resources</p>
        
        <!-- Create New Category Form -->
        <div style="background: #f8f9ff; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; border: 1px solid #e0e7ff;">
          <h3 style="margin-bottom: 1rem; color: #232946;">‚ûï Create New Category</h3>
          <form method="POST" action="/create-category" class="login-form">
            <div class="form-grid">
              <div class="form-group">
                <label for="category_name">Category Name *</label>
                <input type="text" id="category_name" name="category_name" placeholder="e.g., Advanced Mathematics" required>
              </div>
              <div class="form-group">
                <label for="category_type">Category Type</label>
                <select id="category_type" name="category_type">
                  <option value="general">General</option>
                  <option value="subject_specific">Subject Specific</option>
                  <option value="exam_prep">Exam Preparation</option>
                  <option value="skill_based">Skill Based</option>
                  <option value="project_based">Project Based</option>
                </select>
              </div>
              <div class="form-group">
                <label for="target_class">Target Class</label>
                <select id="target_class" name="target_class">
                  <option value="all">All Classes</option>
                  {% for id, name in all_classes %}
                    <option value="{{ id }}">{{ name|title }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="form-group">
                <label for="paid_status">Access Level</label>
                <select id="paid_status" name="paid_status">
                  <option value="unpaid">Free for All</option>
                  <option value="paid">Paid Access</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label for="category_description">Description</label>
              <textarea id="category_description" name="category_description" placeholder="Describe what types of resources belong in this category..."></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Create Category</button>
          </form>
        </div>
        
        <!-- Existing Categories -->
        <div style="background: #fff; border-radius: 12px; padding: 1.5rem; border: 1px solid #e0e7ff;">
          <h3 style="margin-bottom: 1rem; color: #232946;">üìã Existing Categories</h3>
          <div class="resource-grid" id="categoriesGrid">
            <!-- Default Categories -->
            <div class="resource-card">
              <span class="resource-status status-paid">Default</span>
              <h3>Notes</h3>
              <p><strong>Type:</strong> General</p>
              <p><strong>Target:</strong> All Classes</p>
              <p><strong>Access:</strong> Free</p>
              <p><strong>Description:</strong> Study notes and summaries</p>
            </div>
            
            <div class="resource-card">
              <span class="resource-status status-paid">Default</span>
              <h3>Worksheets</h3>
              <p><strong>Type:</strong> Skill Based</p>
              <p><strong>Target:</strong> All Classes</p>
              <p><strong>Access:</strong> Free</p>
              <p><strong>Description:</strong> Practice worksheets and exercises</p>
            </div>
            
            <div class="resource-card">
              <span class="resource-status status-paid">Default</span>
              <h3>Formula Sheets</h3>
              <p><strong>Type:</strong> Subject Specific</p>
              <p><strong>Target:</strong> All Classes</p>
              <p><strong>Access:</strong> Free</p>
              <p><strong>Description:</strong> Mathematical formulas and concepts</p>
            </div>
            
            <div class="resource-card">
              <span class="resource-status status-paid">Default</span>
              <h3>Practice Tests</h3>
              <p><strong>Type:</strong> Exam Preparation</p>
              <p><strong>Target:</strong> All Classes</p>
              <p><strong>Access:</strong> Free</p>
              <p><strong>Description:</strong> Mock tests and practice exams</p>
            </div>
            
            <div class="resource-card">
              <span class="resource-status status-paid">Default</span>
              <h3>Reference Books</h3>
              <p><strong>Type:</strong> General</p>
              <p><strong>Target:</strong> All Classes</p>
              <p><strong>Access:</strong> Free</p>
              <p><strong>Description:</strong> Reference materials and textbooks</p>
            </div>
            
            <div class="resource-card">
              <span class="resource-status status-paid">Default</span>
              <h3>Videos</h3>
              <p><strong>Type:</strong> General</p>
              <p><strong>Target:</strong> All Classes</p>
              <p><strong>Access:</strong> Free</p>
              <p><strong>Description:</strong> Educational videos and tutorials</p>
            </div>
            
            <div class="resource-card">
              <span class="resource-status status-paid">Default</span>
              <h3>Other</h3>
              <p><strong>Type:</strong> General</p>
              <p><strong>Target:</strong> All Classes</p>
              <p><strong>Access:</strong> Free</p>
              <p><strong>Description:</strong> Miscellaneous educational resources</p>
            </div>
            
            <!-- Dynamic Categories will be loaded here -->
            {% for category in categories %}
            <div class="resource-card">
              <span class="resource-status {% if category[5] == 'paid' %}status-paid{% else %}status-unpaid{% endif %}">
                {{ category[5]|title }}
              </span>
              <h3>{{ category[1] }}</h3>
              <p><strong>Type:</strong> {{ category[3]|replace('_', ' ')|title }}</p>
              <p><strong>Target:</strong> {% if category[4] == 'all' %}All Classes{% else %}{{ category[4] }}{% endif %}</p>
              <p><strong>Access:</strong> {{ category[5]|title }}</p>
              <p><strong>Description:</strong> {{ category[2] or 'No description' }}</p>
              <div style="margin-top: 1rem;">
                <button class="btn-secondary" onclick="editCategory({{ category[0] }})">Edit</button>
                <button class="btn-secondary" onclick="deleteCategory({{ category[0] }})">Delete</button>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
      
      <!-- Scheduled Resources Tab -->
      <div id="scheduled-tab" class="tab-content">
        <h2>Scheduled Resources</h2>
        <div class="resource-grid">
          <div class="resource-card">
            <span class="resource-status status-scheduled">Scheduled</span>
            <h3>Physics Lab Manual</h3>
            <p><strong>Category:</strong> Notes</p>
            <p><strong>Target Class:</strong> Class 11</p>
            <p><strong>Scheduled:</strong> Tomorrow, 9:00 AM</p>
            <p><strong>Status:</strong> Paid</p>
            <div style="margin-top: 1rem;">
              <button class="btn-primary" onclick="uploadNow(1)">Upload Now</button>
              <button class="btn-secondary" onclick="editSchedule(1)">Edit</button>
              <button class="btn-secondary" onclick="deleteSchedule(1)">Delete</button>
            </div>
          </div>
          
          <div class="resource-card">
            <span class="resource-status status-scheduled">Scheduled</span>
            <h3>Chemistry Quiz</h3>
            <p><strong>Category:</strong> Practice Test</p>
            <p><strong>Target Class:</strong> Class 12</p>
            <p><strong>Scheduled:</strong> Friday, 2:00 PM</p>
            <p><strong>Status:</strong> Free</p>
            <div style="margin-top: 1rem;">
              <button class="btn-primary" onclick="uploadNow(2)">Upload Now</button>
              <button class="btn-secondary" onclick="editSchedule(2)">Edit</button>
              <button class="btn-secondary" onclick="deleteSchedule(2)">Delete</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Upload History Tab -->
      <div id="history-tab" class="tab-content">
        <h2>Upload History</h2>
        
        <!-- Sorting and Filtering Controls -->
        <div style="background: #f8f9ff; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; border: 1px solid #e0e7ff;">
          <h3 style="margin-bottom: 1rem; color: #232946;">Sort & Filter Resources</h3>
          <div class="filter-controls">
            <div>
              <label for="sortBy" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #232946;">Sort By:</label>
              <select id="sortBy" style="width: 100%; padding: 0.8rem 1rem; border: 1px solid #e0e7ff; border-radius: 8px; font-size: 1rem;">
                <option value="filename">File Name</option>
                <option value="title">Title</option>
                <option value="class">Class</option>
                <option value="category">Category</option>
                <option value="date">Upload Date</option>
              </select>
            </div>
            <div>
              <label for="filterClass" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #232946;">Filter by Class:</label>
              <select id="filterClass" style="width: 100%; padding: 0.8rem 1rem; border: 1px solid #e0e7ff; border-radius: 8px; font-size: 1rem;">
                <option value="">All Classes</option>
                {% for cid, cname in all_classes %}
                <option value="{{ cid }}">{{ cname|title }}</option>
                {% endfor %}
              </select>
            </div>
            <div>
              <label for="filterCategory" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #232946;">Filter by Category:</label>
              <select id="filterCategory" style="width: 100%; padding: 0.8rem 1rem; border: 1px solid #e0e7ff; border-radius: 8px; font-size: 1rem;">
                <option value="">All Categories</option>
                <option value="notes">Notes</option>
                <option value="worksheet">Worksheet</option>
                <option value="formula">Formula Sheet</option>
                <option value="practice_test">Practice Test</option>
                <option value="reference_book">Reference Book</option>
                <option value="video">Video</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div>
              <label for="searchText" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #232946;">Search:</label>
              <input type="text" id="searchText" placeholder="Search by title, filename, or description..." style="width: 100%; padding: 0.8rem 1rem; border: 1px solid #e0e7ff; border-radius: 8px; font-size: 1rem;">
            </div>
          </div>
          <div class="filter-buttons">
            <button onclick="applyFilters()" class="btn-primary">Apply Filters</button>
            <button onclick="clearFilters()" class="btn-secondary">Clear Filters</button>
            <button onclick="exportFilteredResults()" class="export-btn">Export Results</button>
          </div>
          <div id="filterResults" style="margin-top: 1rem; padding: 0.8rem; background: #e8f5e8; border-radius: 8px; display: none;">
            <span id="resultCount" style="font-weight: 600; color: #155724;"></span>
          </div>
        </div>
        
        <div class="resource-grid" id="resourcesGrid">
          {% for r in resources %}
          {% set filename = r[1] %}
          {% set class_id = r[2] %}
          {% set filepath = r[3] %}
          {% set title = r[4] %}
          {% set description = r[5] %}
          {% set category = r[6] %}
          <div class="resource-card" 
               data-filename="{{ filename }}" 
               data-title="{{ title or filename }}" 
               data-class="{{ class_id }}" 
               data-category="{{ category }}"
               data-description="{{ description or '' }}"
               data-class-name="{% for cid, cname in all_classes %}{% if cid == class_id %}{{ cname|title }}{% endif %}{% endfor %}">
            <span class="resource-status {% if category in ['worksheet', 'formula'] %}status-paid{% else %}status-unpaid{% endif %}">
              {% if category in ['worksheet', 'formula'] %}Paid{% else %}Free{% endif %}
            </span>
            <h3>{{ title or filename }}</h3>
            <p><strong>File:</strong> {{ filename }}</p>
            <p><strong>Category:</strong> {{ category|title }}</p>
            <p><strong>Class:</strong> 
              {% for cid, cname in all_classes %}{% if cid == class_id %}{{ cname|title }}{% endif %}{% endfor %}
            </p>
            {% if description %}
            <p><strong>Description:</strong> {{ description[:100] }}{% if description|length > 100 %}...{% endif %}</p>
            {% endif %}
            <div style="margin-top: 1rem;">
              <a href="/preview/{{ filename }}" class="btn-primary">Preview Document</a>
              <button onclick="editResource('{{ filename }}', '{{ class_id }}', '{{ category }}', '{{ title or filename }}', '{{ description or '' }}')" class="btn-secondary">Edit</button>
              <form method="POST" action="/admin/delete-resource/{{ filename }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this resource?');">
                <button type="submit" class="btn-secondary">Delete</button>
              </form>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </main>

  <!-- Edit Resource Dialog -->
  <div id="editResourceDialog" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Resource</h2>
        <span class="close" onclick="closeEditDialog()">&times;</span>
      </div>
      <form id="editResourceForm" method="POST" action="/edit-resource">
        <input type="hidden" id="editFilename" name="filename">
        <div class="form-grid">
          <div class="form-group">
            <label for="editTitle">Resource Title</label>
            <input type="text" id="editTitle" name="title" required>
          </div>
          <div class="form-group">
            <label for="editCategory">Category</label>
            <select id="editCategory" name="category" required>
              <option value="">Select Category</option>
              <!-- Default Categories -->
              <option value="notes">Notes</option>
              <option value="worksheet">Worksheet</option>
              <option value="formula">Formula Sheet</option>
              <option value="practice_test">Practice Test</option>
              <option value="reference_book">Reference Book</option>
              <option value="video">Video</option>
              <option value="other">Other</option>
              <!-- Dynamic Categories -->
              {% for category in categories %}
                <option value="{{ category[1] }}">{{ category[1] }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="editClass">Target Class</label>
            <select id="editClass" name="class_id" required>
              <option value="">Select Class</option>
              {% for id, name in all_classes %}
                <option value="{{ id }}">{{ name|title }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="editPaidStatus">Access Level</label>
            <select id="editPaidStatus" name="paid_status">
              <option value="unpaid">Free</option>
              <option value="paid">Paid</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="editDescription">Description</label>
          <textarea id="editDescription" name="description" placeholder="Brief description of the resource content..."></textarea>
        </div>
        <div class="modal-actions">
          <button type="submit" class="btn-primary">Save Changes</button>
          <button type="button" class="btn-secondary" onclick="closeEditDialog()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <footer class="footer">
    <div class="container footer-content">
      <div class="uiverse-social-container">
        <a href="https://www.instagram.com/sunrise_education_centre?igsh=OGc5enlsanE0eWJ2" target="_blank" class="uiverse-social-btn instagram" title="Instagram">
          <img src="footer/instagram-brands-solid-full.svg" alt="Instagram" style="width: 24px; height: 24px; display: inline-block; vertical-align: middle;">
        </a>
        <a href="https://www.youtube.com/@MohitNariyani" target="_blank" class="uiverse-social-btn youtube" title="YouTube">
          <i class="fab fa-youtube"></i>
        </a>
      </div>
      <div class="footer-links">
        <a href="#">Privacy Policy</a>
        <a href="#">Contact Us</a>
      </div>
      <div class="footer-copy">&copy; 2024 Sunrise Education Centre</div>
      <div class="footer-theme-toggle">
        <button id="footerThemeToggle" type="button" aria-pressed="false">
          üåô Dark Mode
        </button>
      </div>
    </div>
  </footer>

  <script src="script.js"></script>
  <script src="bulk_upload/bulk_upload.js"></script>
  <script>
    function showTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      
      // Resolve id: accept both 'upload' and 'upload-tab'
      const targetId = tabName.endsWith('-tab') ? tabName : (tabName + '-tab');
      const target = document.getElementById(targetId);
      if (target) target.classList.add('active');
      if (window.event && window.event.target) {
        window.event.target.classList.add('active');
      }
    }
    
    // File upload handling
    const fileInput = document.getElementById('file');
    const fileUploadArea = document.getElementById('fileUploadArea');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    
    fileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        fileName.textContent = file.name;
        fileInfo.style.display = 'block';
      } else {
        fileInfo.style.display = 'none';
      }
    });
    
    // Drag and drop functionality
    fileUploadArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      fileUploadArea.classList.add('dragover');
    });
    
    fileUploadArea.addEventListener('dragleave', function(e) {
      e.preventDefault();
      fileUploadArea.classList.remove('dragover');
    });
    
    fileUploadArea.addEventListener('drop', function(e) {
      e.preventDefault();
      fileUploadArea.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        fileInput.files = files;
        fileName.textContent = files[0].name;
        fileInfo.style.display = 'block';
      }
    });
    
    // Scheduled resource functions
    function uploadNow(id) {
      if (confirm('Upload this resource now?')) {
        alert('Resource uploaded successfully!');
      }
    }
    
    function editSchedule(id) {
      alert('Edit functionality coming soon!');
    }
    
    function deleteSchedule(id) {
      if (confirm('Are you sure you want to delete this scheduled resource?')) {
        alert('Scheduled resource deleted successfully!');
      }
    }
    
    // Sorting and Filtering Functions
    function applyFilters() {
      const sortBy = document.getElementById('sortBy').value;
      const filterClass = document.getElementById('filterClass').value;
      const filterCategory = document.getElementById('filterCategory').value;
      const searchText = document.getElementById('searchText').value.toLowerCase();
      
      const resourceCards = document.querySelectorAll('#resourcesGrid .resource-card');
      let visibleCount = 0;
      
      resourceCards.forEach(card => {
        const filename = card.dataset.filename.toLowerCase();
        const title = card.dataset.title.toLowerCase();
        const classId = card.dataset.class;
        const category = card.dataset.category;
        const description = card.dataset.description.toLowerCase();
        const className = card.dataset.className.toLowerCase();
        
        // Apply filters
        let shouldShow = true;
        
        // Filter by class
        if (filterClass && classId !== filterClass) {
          shouldShow = false;
        }
        
        // Filter by category
        if (filterCategory && category !== filterCategory) {
          shouldShow = false;
        }
        
        // Filter by search text
        if (searchText) {
          const searchableText = `${filename} ${title} ${description} ${className}`;
          if (!searchableText.includes(searchText)) {
            shouldShow = false;
          }
        }
        
        // Show/hide card
        if (shouldShow) {
          card.style.display = 'block';
          visibleCount++;
        } else {
          card.style.display = 'none';
        }
      });
      
      // Sort visible cards
      const visibleCards = Array.from(resourceCards).filter(card => card.style.display !== 'none');
      visibleCards.sort((a, b) => {
        let aValue, bValue;
        
        switch (sortBy) {
          case 'filename':
            aValue = a.dataset.filename.toLowerCase();
            bValue = b.dataset.filename.toLowerCase();
            break;
          case 'title':
            aValue = a.dataset.title.toLowerCase();
            bValue = b.dataset.title.toLowerCase();
            break;
          case 'class':
            aValue = a.dataset.className.toLowerCase();
            bValue = b.dataset.className.toLowerCase();
            break;
          case 'category':
            aValue = a.dataset.category.toLowerCase();
            bValue = b.dataset.category.toLowerCase();
            break;
          default:
            return 0;
        }
        
        return aValue.localeCompare(bValue);
      });
      
      // Reorder cards in DOM
      const grid = document.getElementById('resourcesGrid');
      visibleCards.forEach(card => grid.appendChild(card));
      
      // Show result count
      const resultDiv = document.getElementById('filterResults');
      const resultCount = document.getElementById('resultCount');
      resultDiv.style.display = 'block';
      resultCount.textContent = `Showing ${visibleCount} of ${resourceCards.length} resources`;
      
      // Add visual feedback
      if (visibleCount === 0) {
        resultCount.textContent = 'No resources match your filters';
        resultDiv.style.background = '#fef2f2';
        resultCount.style.color = '#dc2626';
      } else {
        resultDiv.style.background = '#e8f5e8';
        resultCount.style.color = '#155724';
      }
    }
    
    function clearFilters() {
      // Reset all filter inputs
      document.getElementById('sortBy').value = 'filename';
      document.getElementById('filterClass').value = '';
      document.getElementById('filterCategory').value = '';
      document.getElementById('searchText').value = '';
      
      // Show all cards
      const resourceCards = document.querySelectorAll('#resourcesGrid .resource-card');
      resourceCards.forEach(card => {
        card.style.display = 'block';
      });
      
      // Hide result count
      document.getElementById('filterResults').style.display = 'none';
      
      // Reset to original order (filename sort)
      applyFilters();
    }
    
    function exportFilteredResults() {
      const visibleCards = document.querySelectorAll('#resourcesGrid .resource-card[style*="display: block"], #resourcesGrid .resource-card:not([style*="display: none"])');
      
      if (visibleCards.length === 0) {
        alert('No resources to export. Please adjust your filters.');
        return;
      }
      
      const exportData = Array.from(visibleCards).map(card => ({
        filename: card.dataset.filename,
        title: card.dataset.title,
        class: card.dataset.className,
        category: card.dataset.category,
        description: card.dataset.description,
        status: card.querySelector('.resource-status').textContent.trim()
      }));
      
      // Create CSV content
      const headers = ['Filename', 'Title', 'Class', 'Category', 'Description', 'Status'];
      const csvContent = [
        headers.join(','),
        ...exportData.map(row => [
          `"${row.filename}"`,
          `"${row.title}"`,
          `"${row.class}"`,
          `"${row.category}"`,
          `"${row.description}"`,
          `"${row.status}"`
        ].join(','))
      ].join('\n');
      
      // Create and download file
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `resource_export_${new Date().toISOString().split('T')[0]}.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
      
      alert(`Exported ${exportData.length} resources successfully!`);
    }
    
    // Add event listeners for real-time filtering
    document.addEventListener('DOMContentLoaded', function() {
      const searchInput = document.getElementById('searchText');
      const filterClass = document.getElementById('filterClass');
      const filterCategory = document.getElementById('filterCategory');
      
      // Debounce function for search
      let searchTimeout;
      searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(applyFilters, 300);
      });
      
      // Apply filters when dropdowns change
      filterClass.addEventListener('change', applyFilters);
      filterCategory.addEventListener('change', applyFilters);
      
      // Initialize with default sort
      applyFilters();
      
      // Initialize create resource file handling
      setupCreateResourceFileHandling();
    });
    
    // Create Resource Functions
    function showResourceFields() {
      const resourceType = document.getElementById('resource_type').value;
      
      // Hide all specific fields first
      document.getElementById('worksheet-fields').style.display = 'none';
      document.getElementById('pyq-fields').style.display = 'none';
      document.getElementById('cbq-fields').style.display = 'none';
      
      // Show relevant fields based on resource type
      switch(resourceType) {
        case 'worksheet':
          document.getElementById('worksheet-fields').style.display = 'block';
          break;
        case 'pyq':
          document.getElementById('pyq-fields').style.display = 'block';
          break;
        case 'cbq':
          document.getElementById('cbq-fields').style.display = 'block';
          break;
      }
    }
    
    function setupCreateResourceFileHandling() {
      const createFileInput = document.getElementById('create_file');
      const createFileUploadArea = document.getElementById('createFileUploadArea');
      const createFileInfo = document.getElementById('createFileInfo');
      const createFileName = document.getElementById('createFileName');
      
      if (createFileInput) {
        createFileInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file) {
            createFileName.textContent = file.name;
            createFileInfo.style.display = 'block';
          } else {
            createFileInfo.style.display = 'none';
          }
        });
      }
      
      if (createFileUploadArea) {
        // Drag and drop functionality for create resource
        createFileUploadArea.addEventListener('dragover', function(e) {
          e.preventDefault();
          createFileUploadArea.classList.add('dragover');
        });
        
        createFileUploadArea.addEventListener('dragleave', function(e) {
          e.preventDefault();
          createFileUploadArea.classList.remove('dragover');
        });
        
        createFileUploadArea.addEventListener('drop', function(e) {
          e.preventDefault();
          createFileUploadArea.classList.remove('dragover');
          const files = e.dataTransfer.files;
          if (files.length > 0) {
            createFileInput.files = files;
            createFileName.textContent = files[0].name;
            createFileInfo.style.display = 'block';
          }
        });
      }
    }
    
    // Category management functions
    function editCategory(categoryId) {
        // TODO: Implement edit category modal/form
        alert('Edit category functionality will be implemented soon!');
    }
    
    function deleteCategory(categoryId) {
        if (confirm('Are you sure you want to delete this category? This action cannot be undone.')) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/delete-category/${categoryId}`;
            document.body.appendChild(form);
            form.submit();
        }
    }
    
    // Resource edit functions
    function editResource(filename, classId, category, title, description) {
        // Populate the edit form
        document.getElementById('editFilename').value = filename;
        document.getElementById('editTitle').value = title;
        document.getElementById('editCategory').value = category;
        document.getElementById('editClass').value = classId;
        document.getElementById('editDescription').value = description;
        
        // Determine paid status based on category
        const paidStatus = (category === 'worksheet' || category === 'formula') ? 'paid' : 'unpaid';
        document.getElementById('editPaidStatus').value = paidStatus;
        
        // Show the modal
        document.getElementById('editResourceDialog').style.display = 'block';
    }
    
    function closeEditDialog() {
        document.getElementById('editResourceDialog').style.display = 'none';
    }
    
    // Close modal when clicking outside
    window.onclick = function(event) {
        const modal = document.getElementById('editResourceDialog');
        if (event.target === modal) {
            closeEditDialog();
        }
    }
    
    // Form validation for create resource
    function validateCreateResourceForm() {
      const resourceType = document.getElementById('resource_type').value;
      const classId = document.getElementById('create_class_id').value;
      const subject = document.getElementById('subject').value;
      const file = document.getElementById('create_file').files[0];
      
      if (!resourceType) {
        alert('Please select a resource type');
        return false;
      }
      
      if (!classId) {
        alert('Please select a target class');
        return false;
      }
      
      if (!subject) {
        alert('Please select a subject');
        return false;
      }
      
      if (!file) {
        alert('Please upload a file');
        return false;
      }
      
      // Validate file type
      const allowedTypes = ['.pdf', '.doc', '.docx', '.ppt', '.pptx'];
      const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
      if (!allowedTypes.includes(fileExtension)) {
        alert('Please upload a valid file type (PDF, DOC, DOCX, PPT, PPTX)');
        return false;
      }
      
      return true;
    }
    
    // Add form validation to create resource form
    document.addEventListener('DOMContentLoaded', function() {
      const createForm = document.querySelector('form[action="/create-resource"]');
      if (createForm) {
        createForm.addEventListener('submit', function(e) {
          if (!validateCreateResourceForm()) {
            e.preventDefault();
          }
        });
      }
    });
  </script>

    <!-- Search Modal -->
    <div id="searchModal" class="modal" style="display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
        <div class="modal-content black-glass" style="margin: 10% auto; padding: 2rem; border-radius: 20px; width: 90%; max-width: 600px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="color: white; margin: 0;">üîç Search</h2>
                <button onclick="closeSearch()" style="background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer;">‚úï</button>
            </div>
            <input type="text" id="searchInput" placeholder="Search courses, resources, or topics..." style="width: 100%; padding: 15px; border: none; border-radius: 10px; background: rgba(255,255,255,0.1); color: white; font-size: 1rem; margin-bottom: 1rem;">
            <div id="searchResults" style="max-height: 300px; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- Notification Panel -->
    <div id="notification-panel" class="notification-panel black-glass" style="display: none; position: fixed; top: 100px; right: 20px; width: 350px; max-height: 500px; overflow-y: auto; z-index: 999; border-radius: 16px; padding: 1rem; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.2);">
            <h3 style="margin: 0; font-size: 1.2rem; color: white;">üîî Notifications</h3>
            <button onclick="toggleNotifications()" style="background: none; border: none; color: #fff; font-size: 1.2rem; cursor: pointer; padding: 0.2rem;">‚úï</button>
        </div>
        <div class="notification-list">
            <div class="notification-item" style="padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 0.5rem;">
                <div style="font-weight: 600; margin-bottom: 0.3rem; color: white;">üìö Latest Updates</div>
                <div style="font-size: 0.9rem; opacity: 0.8; color: rgba(255,255,255,0.8);">Check out new features and content</div>
            </div>
        </div>
    </div>

    <script src="navbar-functions.js"></script>
</body>
<script src="/attached_assets/theme.js"></script>
</html> 