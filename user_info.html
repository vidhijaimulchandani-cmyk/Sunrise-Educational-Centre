<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>User Management - Admin Panel</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap">
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="floating-navbar.css" />
  <link rel="stylesheet" href="uiverse-components.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="script.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Inter', sans-serif;
      margin: 0;
      min-height: 100vh;
      color: #333;
    }

    body.dark-mode {
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .admin-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    .page-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .page-title {
      font-size: 2.5rem;
      font-weight: 800;
      color: #fff;
      margin-bottom: 0.5rem;
      text-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    .page-subtitle {
      font-size: 1.1rem;
      color: rgba(255,255,255,0.8);
      font-weight: 400;
    }

    .user-card {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 2.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 20px 60px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.2);
    }

    body.dark-mode .user-card {
      background: rgba(35,41,70,0.95);
      border: 1px solid rgba(255,255,255,0.1);
    }

    .user-avatar-section {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 2px solid rgba(102,126,234,0.1);
    }

    .user-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: 700;
      color: #fff;
      box-shadow: 0 8px 32px rgba(102,126,234,0.3);
    }

    .user-info-header {
      flex: 1;
    }

    .user-name {
      font-size: 1.8rem;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 0.25rem;
    }

    body.dark-mode .user-name {
      color: #fff;
    }

    .user-role {
      font-size: 1rem;
      color: #667eea;
      font-weight: 600;
      background: rgba(102,126,234,0.1);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      display: inline-block;
    }

    .user-stats {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: rgba(102,126,234,0.1);
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      color: #667eea;
    }

    .form-section {
      margin-bottom: 2rem;
    }

    .section-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    body.dark-mode .section-title {
      color: #fff;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-label {
      font-weight: 600;
      color: #4a5568;
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }

    body.dark-mode .form-label {
      color: #e2e8f0;
    }

    .form-input {
      padding: 0.875rem 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 1rem;
      font-family: 'Inter', sans-serif;
      background: #f7fafc;
      color: #2d3748;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }

    .form-input:focus {
      outline: none;
      border-color: #667eea;
      background: #fff;
      box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
    }

    body.dark-mode .form-input {
      background: #2d3748;
      border-color: #4a5568;
      color: #e2e8f0;
    }

    body.dark-mode .form-input:focus {
      background: #1a202c;
      border-color: #667eea;
    }

    .form-input::placeholder {
      color: #a0aec0;
    }

    .form-select {
      padding: 0.875rem 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 1rem;
      font-family: 'Inter', sans-serif;
      background: #f7fafc;
      color: #2d3748;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    body.dark-mode .form-select {
      background: #2d3748;
      border-color: #4a5568;
      color: #e2e8f0;
    }

    .form-select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
    }

    .action-buttons {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 2px solid rgba(102,126,234,0.1);
    }

    .btn-update {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      border: none;
      padding: 0.875rem 2rem;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 20px rgba(102,126,234,0.3);
    }

    .btn-update:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(102,126,234,0.4);
    }

    .btn-danger {
      background: linear-gradient(135deg, #fc5c7d, #c44569);
      color: #fff;
      border: none;
      padding: 0.875rem 2rem;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 20px rgba(252,92,125,0.3);
    }

    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(252,92,125,0.4);
    }

    .btn-warning {
      background: linear-gradient(135deg, #f39c12, #e67e22);
      color: #fff;
      border: none;
      padding: 0.875rem 2rem;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 20px rgba(243,156,18,0.3);
    }

    .btn-warning:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(243,156,18,0.4);
    }

    .back-link {
      text-align: center;
      margin-top: 2rem;
    }

    .back-link a {
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .back-link a:hover {
      background: rgba(255,255,255,0.2);
      transform: translateY(-2px);
    }

    .error-message {
      background: linear-gradient(135deg, #fc5c7d, #c44569);
      color: #fff;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      font-weight: 600;
      text-align: center;
      box-shadow: 0 4px 20px rgba(252,92,125,0.3);
    }

    .success-message {
      background: linear-gradient(135deg, #48bb78, #38a169);
      color: #fff;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      font-weight: 600;
      text-align: center;
      box-shadow: 0 4px 20px rgba(72,187,120,0.3);
    }

    .settings-section {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.2);
    }

    body.dark-mode .settings-section {
      background: rgba(35,41,70,0.95);
      border: 1px solid rgba(255,255,255,0.1);
    }

    .setting-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 0;
      border-bottom: 1px solid rgba(102,126,234,0.1);
    }

    .setting-item:last-child {
      border-bottom: none;
    }

    .setting-info h4 {
      margin: 0 0 0.25rem 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: #2d3748;
    }

    body.dark-mode .setting-info h4 {
      color: #fff;
    }

    .setting-info p {
      margin: 0;
      font-size: 0.9rem;
      color: #718096;
    }

    body.dark-mode .setting-info p {
      color: #a0aec0;
    }

    .theme-toggle {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 20px rgba(102,126,234,0.3);
    }

    .theme-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(102,126,234,0.4);
    }

    @media (max-width: 768px) {
      .admin-container {
        padding: 1rem;
      }

      .page-title {
        font-size: 2rem;
      }

      .user-avatar-section {
        flex-direction: column;
        text-align: center;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .action-buttons {
        flex-direction: column;
      }

      .user-stats {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar glassmorphic">
    <div class="container nav-content">
      <div class="nav-logo">
        <img src="attached_assets/image_1750584670920.png" alt="Logo">
        <span>Admin Panel</span>
      </div>
      <ul class="nav-links">
        <li><a href="/admin">Dashboard</a></li>
        <li><a href="/logout" class="btn btn-primary">Logout</a></li>
      </ul>
    </div>
  </nav>

  <div class="admin-container">
    <div class="page-header">
      <h1 class="page-title">User Management</h1>
      <p class="page-subtitle">Edit user information and manage account settings</p>
    </div>

    {% if error %}
    <div class="error-message">
      <i class="fas fa-exclamation-triangle"></i> {{ error }}
    </div>
    {% endif %}

    {% if success %}
    <div class="success-message">
      <i class="fas fa-check-circle"></i> {{ success }}
    </div>
    {% endif %}

    <div class="user-card">
      <div class="user-avatar-section">
        <div class="user-avatar">
          {{ user[1][0].upper() if user[1] else 'U' }}
        </div>
        <div class="user-info-header">
          <h2 class="user-name">{{ user[1] if user[1] else 'Unknown User' }}</h2>
          <div class="user-role">Administrator</div>
          <div class="user-stats">
            <div class="stat-item">
              <i class="fas fa-calendar"></i>
              <span>Joined {{ user[4] if user[4] else 'Recently' }}</span>
            </div>
            <div class="stat-item">
              <i class="fas fa-tag"></i>
              <span>{{ user[3] if user[3] else 'Unknown' }}</span>
            </div>
            <div class="stat-item">
              <i class="fas fa-graduation-cap"></i>
              <span>Class {{ user[2] if user[2] else 'N/A' }}</span>
            </div>
          </div>
        </div>
      </div>

      <form method="POST" class="login-form">
        <div class="form-section">
          <h3 class="section-title">
            <i class="fas fa-user-edit"></i>
            Basic Information
          </h3>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label" for="username">Username</label>
              <input type="text" id="username" name="username" value="{{ user[1] }}" required class="form-input" placeholder="Enter username" />
            </div>
            <div class="form-group">
              <label class="form-label" for="password">New Password</label>
              <input type="password" id="password" name="password" class="form-input" placeholder="Leave blank to keep current password" />
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3 class="section-title">
            <i class="fas fa-graduation-cap"></i>
            Academic Information
          </h3>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label" for="class_id">Class</label>
              <select id="class_id" name="class_id" required class="form-select">
                {% for id, name in all_classes %}
                  <option value="{{ id }}" {% if user[2] == id %}selected{% endif %}>{{ name|title }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="form-group">
              <label class="form-label" for="paid">Payment Status</label>
              <select id="paid" name="paid" required class="form-select">
                <option value="not paid" {% if user[3]=='not paid' %}selected{% endif %}>Not Paid</option>
                <option value="paid" {% if user[3]=='paid' %}selected{% endif %}>Paid</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3 class="section-title">
            <i class="fas fa-address-book"></i>
            Contact Information
          </h3>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label" for="mobile_no">Mobile Number</label>
              <input type="tel" id="mobile_no" name="mobile_no" value="{{ user[6] or '' }}" class="form-input" placeholder="Enter mobile number" />
            </div>
            <div class="form-group">
              <label class="form-label" for="email_address">Email Address</label>
              <input type="email" id="email_address" name="email_address" value="{{ user[7] or '' }}" class="form-input" placeholder="Enter email address" />
            </div>
          </div>
        </div>

        <div class="action-buttons">
          <button type="submit" class="btn-update">
            <i class="fas fa-save"></i> Update User
          </button>
        </div>
      </form>

      <div class="action-buttons">
        <form method="POST" action="/delete-user/{{ user[0] }}" style="display:inline;">
          <button type="submit" class="btn-danger" onclick="return confirm('⚠️ Are you sure you want to delete this user? This action cannot be undone!');">
            <i class="fas fa-trash"></i> Delete User
          </button>
        </form>
        <form method="POST" action="/admin/ban-user/{{ user[0] }}" style="display:inline;">
          <button type="submit" class="btn-warning" onclick="return confirm('⚠️ Are you sure you want to ban this user?');">
            <i class="fas fa-ban"></i> Ban User
          </button>
        </form>
      </div>
    </div>

    <div class="settings-section">
      <h3 class="section-title">
        <i class="fas fa-cog"></i>
        Appearance Settings
      </h3>
      <div class="setting-item">
        <div class="setting-info">
          <h4>Theme Preference</h4>
          <p>Switch between dark and light themes for better viewing experience</p>
        </div>
        <button id="darkModeToggle" class="theme-toggle">
          <i class="fas fa-moon"></i> Dark Mode
        </button>
      </div>
    </div>

    <div class="back-link">
      <a href="/admin">
        <i class="fas fa-arrow-left"></i>
        Back to Admin Panel
      </a>
    </div>
  </div>

  <footer class="footer">
    <div class="container footer-content">
      <div class="uiverse-social-container">
        <a href="https://www.instagram.com/sunrise_education_centre?igsh=OGc5enlsanE0eWJ2" target="_blank" class="uiverse-social-btn instagram" title="Instagram">
          <img src="footer/instagram-brands-solid-full.svg" alt="Instagram" style="width: 24px; height: 24px; display: inline-block; vertical-align: middle;">
        </a>
        <a href="https://www.youtube.com/@MohitNariyani" target="_blank" class="uiverse-social-btn youtube" title="YouTube">
          <img src="footer/youtube-brands-solid-full.svg" alt="YouTube" style="width: 24px; height: 24px; display: inline-block; vertical-align: middle;">
        </a>
        <a href="https://wa.me/917224860881" target="_blank" class="uiverse-social-btn whatsapp" title="WhatsApp">
          <img src="footer/whatsapp-brands-solid-full.svg" alt="WhatsApp" style="width: 24px; height: 24px; display: inline-block; vertical-align: middle;">
        </a>
      </div>
      <div class="footer-links">
        <a href="#">Privacy Policy</a>
        <a href="#">Contact Us</a>
      </div>
      <div class="footer-copy">&copy; 2024 Sunrise Education Centre</div>
      <div class="footer-theme-toggle">
        <div class="uiverse-theme-slider" title="Theme">
          <label class="switch">
            <input id="footerThemeSlider" type="checkbox" />
            <span class="slider-round"></span>
          </label>
          <span id="footerThemeSliderLabel">Theme</span>
        </div>
        <button id="footerThemeToggle" type="button" aria-pressed="false" style="display:none;">🌙 Dark Mode</button>
      </div>
    </div>
  </footer>

  <script src="script.js"></script>
  <script src="navbar-functions.js"></script>
  <script src="/attached_assets/theme.js"></script>

  <script>
    // Enhanced theme toggle functionality
    document.addEventListener('DOMContentLoaded', function() {
      const darkModeToggle = document.getElementById('darkModeToggle');
      const footerThemeSlider = document.getElementById('footerThemeSlider');
      
      // Sync theme toggles
      function syncThemeToggles() {
        const isDark = document.body.classList.contains('dark-mode');
        footerThemeSlider.checked = isDark;
        darkModeToggle.innerHTML = isDark ? '<i class="fas fa-sun"></i> Light Mode' : '<i class="fas fa-moon"></i> Dark Mode';
      }
      
      // Initialize theme
      syncThemeToggles();
      
      // Theme toggle handlers
      darkModeToggle.addEventListener('click', function() {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        syncThemeToggles();
      });
      
      footerThemeSlider.addEventListener('change', function() {
        document.body.classList.toggle('dark-mode', this.checked);
        localStorage.setItem('darkMode', this.checked);
        syncThemeToggles();
      });
      
      // Load saved theme
      const savedTheme = localStorage.getItem('darkMode');
      if (savedTheme === 'true') {
        document.body.classList.add('dark-mode');
        syncThemeToggles();
      }
    });

    // Enhanced form validation
    document.querySelector('form').addEventListener('submit', function(e) {
      const username = document.getElementById('username').value.trim();
      const mobile = document.getElementById('mobile_no').value.trim();
      const email = document.getElementById('email_address').value.trim();
      
      if (username.length < 3) {
        alert('Username must be at least 3 characters long');
        e.preventDefault();
        return;
      }
      
      if (mobile && !/^\d{10}$/.test(mobile)) {
        alert('Please enter a valid 10-digit mobile number');
        e.preventDefault();
        return;
      }
      
      if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        alert('Please enter a valid email address');
        e.preventDefault();
        return;
      }
    });
  </script>
</body>
</html>